import faiss
import numpy as np
from sentence_transformers import SentenceTransformer

# –ó–∞–≥—Ä—É–∂–∞–µ–º –º–æ–¥–µ–ª—å –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏—è
model = SentenceTransformer("all-MiniLM-L6-v2")

# –ò—Å—Ö–æ–¥–Ω—ã–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã
texts = [
    "–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç RAG?",
    "–í–µ–∫—Ç–æ—Ä–Ω—ã–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Ö—Ä–∞–Ω—è—Ç embeddings.",
    "–ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ —É–ª—É—á—à–∞–µ—Ç –ø–æ–∏—Å–∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.",
    "–ì–ª—É–±–æ–∫–∏–µ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ NLP."
]

# –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Ç–µ–∫—Å—Ç –≤ –≤–µ–∫—Ç–æ—Ä—ã
embeddings = model.encode(texts)
dimension = embeddings.shape[1]  # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å –≤–µ–∫—Ç–æ—Ä–æ–≤

# –°–æ–∑–¥–∞—ë–º –∏–Ω–¥–µ–∫—Å FAISS
index = faiss.IndexFlatL2(dimension)
index.add(np.array(embeddings))  # –î–æ–±–∞–≤–ª—è–µ–º –≤–µ–∫—Ç–æ—Ä—ã –≤ –±–∞–∑—É

# –ó–∞–ø—Ä–æ—Å (—Ç–æ–∂–µ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –≤–µ–∫—Ç–æ—Ä)
query = "–ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –≤–µ–∫—Ç–æ—Ä–Ω—ã–µ –±–∞–∑—ã?"
query_embedding = model.encode([query])

# –ò—â–µ–º 2 –±–ª–∏–∂–∞–π—à–∏—Ö –≤–µ–∫—Ç–æ—Ä–∞
D, I = index.search(np.array(query_embedding), k=2)

# –í—ã–≤–æ–¥–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
print("üîç –ù–∞–π–¥–µ–Ω–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã:")
for idx in I[0]:
    print(f"- {texts[idx]}")
